name: Teams webhook test

on:
  push:
    branches: 
      - main
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main
    
jobs:
  teams-webhook-test:
    name: Teams webhook test
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - run: cat xxx.txt
  
    # „Åì„Çå„ÅØcommit„ÅÆË©≥Á¥∞„Çí„ÄÄÊäï„Åí„Çã„ÇÑ„Å§„Å™„ÅÆ„Åß‰∏çÊé°Áî®
    # - uses: toko-bifrost/ms-teams-deploy-card@master
    #   if: always()
    #   with:
    #     github-token: ${{ secrets.GITHUB_TOKEN }}
    #     webhook-uri: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
  
    # - name: Microsoft Teams Notification
    #   uses: skitionek/notify-microsoft-teams@master
    #   if: success()
    #   with:
    #     webhook_url: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
    #     raw: >-
    #       {
    #         "type": "message",
    #         "attachments":
    #         [
    #           {
    #             "contentType": "application/vnd.microsoft.card.adaptive",
    #             "content":
    #             {
    #               "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
    #               "type": "AdaptiveCard",
    #               "body":[{
    #                 "type": "TextBlock",
    #                 "text": "# üü¢üü¢üü¢üü¢üü¢üü¢",
    #                 "wrap": true,
    #                 "markdown": true
    #               },{
    #                 "type": "TextBlock",
    #                 "text": "# **${{ github.repository }} - ${{ github.workflow }}** „ÅåÊ≠£Â∏∏„Å´ÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü",
    #                 "wrap": true,
    #                 "markdown": true
    #               },{
    #                 "type": "TextBlock",
    #                 "text": "## [PR #${{ github.event.number }} ${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})",
    #                 "wrap": true,
    #                 "markdown": true
    #               },{
    #                 "type": "TextBlock",
    #                 "text": "## [JOB #${{ github.run_id }})](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})",
    #                 "wrap": true,
    #                 "markdown": true
    #               }]
    #             }
    #           }
    #         ]
    #       }

    - name: Microsoft Teams Notification
      uses: skitionek/notify-microsoft-teams@master
      if: failure()
      with:
        webhook_url: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
        raw: >-
          {
            "type": "message",
            "attachments":
            [
              {
                "contentType": "application/vnd.microsoft.card.adaptive",
                "content":
                {
                  "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                  "type": "AdaptiveCard",
                  "body":[{
                    "type": "TextBlock",
                    "text": "# **${{ github.repository }} - ${{ github.workflow }}** ÂÆüË°å‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü",
                    "wrap": true,
                    "markdown": true
                  },{
                    "type": "ColumnSet",
                    "columns": [
                      {
                        "type": "Column",
                        "items": [
                          {
                            "type": "Image",
                            "style": "person",
                            "url": "https://raw.githubusercontent.com/Skitionek/notify-microsoft-teams/master/icons/failure.png",
                            "altText": "Result",
                            "altText": "Result",
                            "size": "small"
                          }
                        ],
                        "width": "auto"
                      },
                      {
                        "type": "Column",
                        "items": [
                          {
                            "type": "TextBlock",
                            "weight": "bolder",
                            "text": "Failure"
                          },
                          {
                            "type": "TextBlock",
                            "text": ""
                          }
                        ],
                        "width": "stretch"
                      }
                    ]
                  },{
                    "type": "TextBlock",
                    "text": "<at>watanabekazuhi@jupiter.jcom.co.jp</at>"
                  },{
                    "type": "ActionSet",
                    "actions": [
                      {
                        "type": "Action.OpenUrl",
                        "title": "Repository",
                        "url": "${{ github.event.repository.url }}"
                      },
                      {
                        "type": "Action.OpenUrl",
                        "title": "PR #${{ github.event.number }} ${{ github.event.pull_request.title }}",
                        "url": "${{ github.event.pull_request.html_url }}"
                      },
                      {
                        "type": "Action.OpenUrl",
                        "title": "JOB #${{ github.run_id }}",
                        "url": "${{ github.event.repository.url }}/actions/runs/${{ github.run_id }}"
                      }
                    ]
                  }],
                  "msteams": {
                    "entities": [
                      {
                        "type": "mention",
                        "text": "<at>watanabekazuhi@jupiter.jcom.co.jp</at>",
                        "mentioned": {
                          "id": "watanabekazuhi@jupiter.jcom.co.jp",
                          "name": "watanabekazuhi@jupiter.jcom.co.jp"
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }

    # - name: Microsoft Teams Notification
    #   uses: skitionek/notify-microsoft-teams@master
    #   if: success()
    #   with:
    #     webhook_url: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
    #     needs: ${{ toJson(needs) }}
    #     job: ${{ toJson(job) }}
    #     steps: ${{ toJson(steps) }}
    
    - name: Microsoft Teams Notification
      uses: skitionek/notify-microsoft-teams@master
      if: failure()
      with:
        webhook_url: ${{ secrets.MS_TEAMS_WEBHOOK_URI }}
        job: ${{ toJson(job) }}
        steps: ${{ toJson(steps) }}
        msteams_emails: "watanabekazuhi@jupiter.jcom.co.jp"